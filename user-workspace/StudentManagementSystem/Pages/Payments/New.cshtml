@page
@model StudentManagementSystem.Pages.Payments.NewModel
@{
    ViewData["Title"] = "Make Payment";
}

<div class="container mt-4">
    <h2 class="mb-4">Make Payment</h2>

    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <form method="post">
                        <div class="mb-3">
                            <label asp-for="Payment.Amount" class="form-label">Amount</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input asp-for="Payment.Amount" class="form-control" type="number" step="0.01" min="0" required />
                            </div>
                            <span asp-validation-for="Payment.Amount" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Payment.Method" class="form-label">Payment Method</label>
                            <select asp-for="Payment.Method" class="form-select" id="paymentMethod" required>
                                <option value="">Select Payment Method</option>
                                <option value="@PaymentMethod.CreditCard">Credit Card</option>
                                <option value="@PaymentMethod.DebitCard">Debit Card</option>
                                <option value="@PaymentMethod.BankTransfer">Bank Transfer</option>
                                <option value="@PaymentMethod.Cash">Cash</option>
                            </select>
                            <span asp-validation-for="Payment.Method" class="text-danger"></span>
                        </div>

                        <!-- Credit Card Details -->
                        <div id="creditCardDetails" style="display: none;">
                            <div class="mb-3">
                                <label class="form-label">Card Number</label>
                                <input type="text" class="form-control" asp-for="CardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Expiry Date</label>
                                <input type="text" class="form-control" asp-for="ExpiryDate" placeholder="MM/YY" maxlength="5">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">CVV</label>
                                <input type="text" class="form-control" asp-for="CVV" placeholder="123" maxlength="3">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Card Holder Name</label>
                                <input type="text" class="form-control" asp-for="CardHolderName" placeholder="John Doe">
                            </div>
                        </div>

                        <!-- Bank Transfer Details -->
                        <div id="bankTransferDetails" style="display: none;">
                            <div class="alert alert-info">
                                <h6>Bank Transfer Information</h6>
                                <p class="mb-1">Bank: University Bank</p>
                                <p class="mb-1">Account Name: Student Management System</p>
                                <p class="mb-1">Account Number: 1234567890</p>
                                <p class="mb-1">Sort Code: 12-34-56</p>
                                <p class="mb-0">Reference: Your Student ID</p>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Payment.Description" class="form-label">Description</label>
                            <textarea asp-for="Payment.Description" class="form-control" rows="3" required></textarea>
                            <span asp-validation-for="Payment.Description" class="text-danger"></span>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-credit-card me-1"></i> Process Payment
                            </button>
                            <a asp-page="/Payments" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-1"></i> Back to Payments
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Payment Information</h5>
                </div>
                <div class="card-body">
                    <p>Please note:</p>
                    <ul>
                        <li>All payments are processed securely</li>
                        <li>Credit/Debit card payments are processed immediately</li>
                        <li>Bank transfers may take 2-3 business days to process</li>
                        <li>Cash payments must be made in person at the finance office</li>
                        <li>A receipt will be emailed to your registered email address</li>
                    </ul>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        For any payment-related issues, please contact the finance office.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        $(document).ready(function() {
            $('#paymentMethod').change(function() {
                const method = $(this).val();
                $('#creditCardDetails').hide();
                $('#bankTransferDetails').hide();
                
                if (method === '@PaymentMethod.CreditCard' || method === '@PaymentMethod.DebitCard') {
                    $('#creditCardDetails').show();
                } else if (method === '@PaymentMethod.BankTransfer') {
                    $('#bankTransferDetails').show();
                }
            });

            // Format card number with spaces
            $('#cardNumber').on('input', function() {
                let value = $(this).val().replace(/\s+/g, '').replace(/[^0-9]/gi, '');
                let formattedValue = value.replace(/\d{4}(?=.)/g, '$& ');
                $(this).val(formattedValue);
            });

            // Format expiry date
            $('#expiryDate').on('input', function() {
                let value = $(this).val().replace(/\D/g, '');
                if (value.length >= 2) {
                    value = value.substring(0, 2) + '/' + value.substring(2);
                }
                $(this).val(value);
            });

            // Only allow numbers in CVV
            $('#cvv').on('input', function() {
                $(this).val($(this).val().replace(/\D/g, ''));
            });
        });
    </script>
}
